<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>„Éî„ÉÉ„ÇØ„É´„Ç≠„É£„ÉÉ„ÉÅ</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
      font-family: "Comic Sans MS", "Arial", sans-serif;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: url('bg.png') no-repeat center center;
      background-size: cover;
    }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-size: 28px;
      text-shadow: 2px 2px 5px black;
      display: flex;
      align-items: center;
      gap: 20px;
    }
    #score {
      font-size: 32px;
      transition: transform 0.2s;
    }
    #lives {
      font-size: 32px;
    }
    #startScreen, #gameOverScreen {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      background: rgba(0,0,0,0.7);
      color: white;
      font-size: 36px;
      z-index: 2;
    }
    button {
      font-size: 28px;
      padding: 15px 30px;
      margin-top: 20px;
      border: none;
      border-radius: 15px;
      background: #ff66cc;
      color: white;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
      transition: transform 0.2s;
    }
    button:hover {
      transform: scale(1.1);
    }
    .pop {
      animation: pop 0.3s ease;
    }
    @keyframes pop {
      0% { transform: scale(1.5); opacity: 0.6; }
      100% { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body>
  <div id="ui">
    <div id="lives">‚ô•‚ô•‚ô•</div>
    <div id="score">Score: 0</div>
  </div>

  <div id="startScreen">
    <div>üéæ „Éî„ÉÉ„ÇØ„É´„Ç≠„É£„ÉÉ„ÉÅ üéæ</div>
    <button id="startBtn">„Çπ„Çø„Éº„Éà</button>
  </div>

  <div id="gameOverScreen" style="display:none;">
    <div id="finalScore">Score: 0</div>
    <button id="retryBtn">„É™„Éà„É©„Ç§</button>
  </div>

  <canvas id="gameCanvas"></canvas>

  <!-- Èü≥Ê•Ω„ÉªÂäπÊûúÈü≥ -->
  <audio id="bgm" src="bgm.mp3" loop></audio>
  <audio id="catchNormal" src="catch_normal.wav"></audio>
  <audio id="catchRare" src="catch_rare.wav"></audio>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // ÁîªÂÉè„É≠„Éº„Éâ
    const paddleImg = new Image(); paddleImg.src = "paddle.png";
    const ballImgs = {
      pink: "pink.png",
      orange: "orange.png",
      blue: "blue.png",
      green: "green.png",
      yellow: "yellow.png",
      lightblue: "lightblue.png",
      rainbow: "rainbow.png"
    };
    const ballsSprites = {};
    for (let key in ballImgs) {
      const img = new Image();
      img.src = ballImgs[key];
      ballsSprites[key] = img;
    }

    let paddle = { x: canvas.width/2, y: canvas.height-100, w: 160, h: 40 };
    let balls = [];
    let score = 0;
    let lives = 3;
    let gameRunning = false;
    let speedFactor = 2;

    const bgm = document.getElementById("bgm");
    bgm.volume = 0.2;
    const catchNormal = document.getElementById("catchNormal");
    const catchRare = document.getElementById("catchRare");

    function resetGame() {
      score = 0;
      lives = 3;
      balls = [];
      for (let i=0;i<3;i++) spawnBall();
      document.getElementById("score").innerText = "Score: 0";
      document.getElementById("lives").innerText = "‚ô•".repeat(lives);
    }

    function spawnBall() {
      const keys = Object.keys(ballsSprites);
      const type = keys[Math.floor(Math.random()*keys.length)];
      balls.push({
        x: Math.random()*(canvas.width-50)+25,
        y: -50,
        r: 40, // Â§ß„Åç„ÇÅ
        type: type,
        speed: type==="rainbow" ? speedFactor*6 : speedFactor*2
      });
    }

    function drawPaddle() {
      ctx.drawImage(paddleImg, paddle.x-paddle.w/2, paddle.y-paddle.h/2, paddle.w*2.3, paddle.h*2.3);
    }

    function drawBalls() {
      balls.forEach(b=>{
        ctx.drawImage(ballsSprites[b.type], b.x-b.r, b.y-b.r, b.r*2.5, b.r*2.5);
      });
    }

    function updateBalls() {
      balls.forEach(b=>{
        b.y += b.speed;
      });
      balls = balls.filter(b=>{
        if (b.y > canvas.height) {
          lives--;
          document.getElementById("lives").innerText = "‚ô•".repeat(lives);
          if (lives<=0) gameOver();
          return false;
        }
        return true;
      });
      if (balls.length<3) spawnBall();
    }

    function checkCatch() {
      balls.forEach((b,i)=>{
        if (b.y+b.r > paddle.y-paddle.h/2 &&
            b.x > paddle.x-paddle.w/2 &&
            b.x < paddle.x+paddle.w/2) {
          score += (b.type==="rainbow"?10:1);
          document.getElementById("score").innerText = "Score: "+score;
          document.getElementById("score").classList.add("pop");
          setTimeout(()=>document.getElementById("score").classList.remove("pop"),200);

          if (b.type==="rainbow") catchRare.play();
          else catchNormal.play();

          balls.splice(i,1);
        }
      });
    }

    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawPaddle();
      drawBalls();
    }

    function loop() {
      if (!gameRunning) return;
      updateBalls();
      checkCatch();
      draw();
      requestAnimationFrame(loop);
    }

    function gameOver() {
      gameRunning = false;
      document.getElementById("gameOverScreen").style.display="flex";
      document.getElementById("finalScore").innerText="Score: "+score;
      document.getElementById("finalScore").classList.add("pop");
    }

    // Êìç‰Ωú
    window.addEventListener("mousemove", e=>{
      paddle.x = e.clientX;
    });
    window.addEventListener("touchmove", e=>{
      paddle.x = e.touches[0].clientX;
    });

    // „Çπ„Çø„Éº„Éà
    document.getElementById("startBtn").addEventListener("click",()=>{
      document.getElementById("startScreen").style.display="none";
      resetGame();
      gameRunning = true;
      bgm.play();
      loop();
    });
    document.getElementById("retryBtn").addEventListener("click",()=>{
      document.getElementById("gameOverScreen").style.display="none";
      resetGame();
      gameRunning = true;
      loop();
    });

    // „Çπ„Éû„Éõ„ÅØÊ®™ÁîªÈù¢Êé®Â•®
    screen.orientation && screen.orientation.lock("landscape").catch(()=>{});
  </script>
</body>
</html>
