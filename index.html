<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Ball Catch Game</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      width: 100%;
      background: black;
      touch-action: none;
    }
    canvas {
      display: block;
      background: url("bg.png") no-repeat center center / cover;
      margin: auto;
    }
    #startScreen, #gameOverScreen {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: url("title.png") no-repeat center center / cover;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 2;
    }
    #startBtn, #retryBtn {
      font-size: 32px;
      padding: 15px 40px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      background: #ff4081;
      color: white;
      font-family: "Fredoka One", sans-serif;
    }
    #scoreboard {
      position: absolute;
      top: 10px; left: 50%;
      transform: translateX(-50%);
      color: white;
      font-size: 36px;
      font-family: "Fredoka One", sans-serif;
      display: flex;
      gap: 30px;
      align-items: center;
    }
    #lives {
      font-size: 72px;
      color: pink;
    }
    #muteBtn {
      position: absolute;
      top: 10px; left: 10px;
      font-size: 32px;
      background: none;
      border: none;
      cursor: pointer;
      z-index: 3;
    }
  </style>
</head>
<body>
  <div id="startScreen">
    <button id="startBtn">„Çπ„Çø„Éº„Éà</button>
  </div>
  <div id="gameOverScreen" style="display:none; background:rgba(0,0,0,0.8);">
    <h1 style="color:white; font-size:48px; font-family:'Fredoka One', sans-serif;">GAME OVER</h1>
    <button id="retryBtn">„É™„Éà„É©„Ç§</button>
  </div>
  <div id="scoreboard">
    <div id="score">0</div>
    <div id="lives">üíóüíóüíó</div>
  </div>
  <button id="muteBtn">üéµ</button>
  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // „É¨„Çπ„Éù„É≥„Ç∑„ÉñÔºàÊ®™Âõ∫ÂÆöÔºâ
    function resizeCanvas() {
      const aspect = 16/9;
      let w = window.innerWidth;
      let h = window.innerHeight;
      if (w / h > aspect) {
        w = h * aspect;
      } else {
        h = w / aspect;
      }
      canvas.width = w;
      canvas.height = h;
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // ÁîªÂÉè
    const paddleImg = new Image();
    paddleImg.src = "paddle.png";
    const ballImages = {
      pink: "pink.png",
      orange: "orange.png",
      blue: "blue.png",
      green: "green.png",
      yellow: "yellow.png",
      lightblue: "lightblue.png",
      rainbow: "rainbow.png"
    };
    for (let key in ballImages) {
      const img = new Image();
      img.src = ballImages[key];
      ballImages[key] = img;
    }

    // Èü≥
    let bgmAudio = new Audio("bgm.mp3");
    bgmAudio.loop = true;
    let gameoverAudio = new Audio("gameover.mp3");
    let missAudio = new Audio("miss.mp3");
    let catchNormalAudio = new Audio("catch_normal.wav");
    let catchRareAudio = new Audio("catch_rare.wav");

    let isMuted = false;
    function updateVolumes() {
      bgmAudio.volume = isMuted ? 0 : 0.2;
      gameoverAudio.volume = isMuted ? 0 : 0.1;
      missAudio.volume = isMuted ? 0 : 1.0;
      catchNormalAudio.volume = isMuted ? 0 : 1.0;
      catchRareAudio.volume = isMuted ? 0 : 1.0;
    }
    function toggleMute() {
      isMuted = !isMuted;
      document.getElementById("muteBtn").textContent = isMuted ? "üîá" : "üéµ";
      updateVolumes();
    }
    document.getElementById("muteBtn").addEventListener("click", toggleMute);

    // „Ç≤„Éº„É†Â§âÊï∞
    let score = 0;
    let lives = 3;
    let balls = [];
    let paddle = { x: 0, y: 0, width: 100, height: 30 };
    let gameRunning = false;
    let lastBallIncrease = 0;
    let maxBalls = 2;

    function resetGame() {
      score = 0;
      lives = 3;
      balls = [];
      maxBalls = 2;
      lastBallIncrease = Date.now();
      paddle.width = canvas.width * 0.15;
      paddle.height = canvas.height * 0.05;
      paddle.x = canvas.width / 2 - paddle.width / 2;
      paddle.y = canvas.height - paddle.height - 10;
      document.getElementById("score").textContent = score;
      document.getElementById("lives").textContent = "üíóüíóüíó";
      gameoverAudio.pause();
      gameoverAudio.currentTime = 0;
      updateVolumes();
    }

    function startGame() {
      document.getElementById("startScreen").style.display = "none";
      document.getElementById("gameOverScreen").style.display = "none";
      resetGame();
      bgmAudio.play();
      gameRunning = true;
      requestAnimationFrame(gameLoop);
    }

    function gameOver() {
      gameRunning = false;
      bgmAudio.pause();
      bgmAudio.currentTime = 0;
      gameoverAudio.play();
      document.getElementById("gameOverScreen").style.display = "flex";
    }

    function spawnBall() {
      const colors = ["pink", "orange", "blue", "green", "yellow", "lightblue"];
      let color = colors[Math.floor(Math.random() * colors.length)];
      if (Math.random() < 0.05) color = "rainbow"; // „É¨„Ç¢Âá∫Áèæ

      let speedMap = {
        pink: 2, orange: 3, blue: 4,
        green: 5, yellow: 6, lightblue: 7,
        rainbow: 9 // „É¨„Ç¢„ÅØÊõ¥„Å´+2
      };

      balls.push({
        x: Math.random() * (canvas.width - 40),
        y: -40,
        size: 60, // Â§ß„Åç„ÇÅ
        speed: speedMap[color],
        color: color
      });
    }

    function gameLoop() {
      if (!gameRunning) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // „Éú„Éº„É´ËøΩÂä†Ôºà5Áßí„Åî„Å®ÊúÄÂ§ß12ÂÄãÔºâ
      if (Date.now() - lastBallIncrease > 5000) {
        if (maxBalls < 12) maxBalls++;
        lastBallIncrease = Date.now();
      }
      if (balls.length < maxBalls) spawnBall();

      // „Éú„Éº„É´ÊèèÁîª
      for (let i = balls.length - 1; i >= 0; i--) {
        const b = balls[i];
        b.y += b.speed;
        ctx.drawImage(ballImages[b.color], b.x, b.y, b.size, b.size);

        if (
          b.y + b.size >= paddle.y &&
          b.x + b.size >= paddle.x &&
          b.x <= paddle.x + paddle.width
        ) {
          // „Ç≠„É£„ÉÉ„ÉÅÂà§ÂÆö
          if (b.color === "rainbow") {
            score += 10;
            catchRareAudio.play();
          } else {
            score += 1;
            catchNormalAudio.play();
          }
          balls.splice(i, 1);
          document.getElementById("score").textContent = score;
        } else if (b.y > canvas.height) {
          // ËêΩ‰∏ã
          if (b.color !== "rainbow") {
            lives--;
            missAudio.play();
          }
          balls.splice(i, 1);
          document.getElementById("lives").textContent = "üíó".repeat(lives);
          if (lives <= 0) {
            gameOver();
          }
        }
      }

      // „Éë„Éâ„É´ÊèèÁîª
      ctx.drawImage(paddleImg, paddle.x, paddle.y, paddle.width, paddle.height);

      requestAnimationFrame(gameLoop);
    }

    // Êìç‰Ωú
    window.addEventListener("mousemove", e => {
      paddle.x = e.clientX / window.innerWidth * canvas.width - paddle.width/2;
      if (paddle.x < 0) paddle.x = 0;
      if (paddle.x + paddle.width > canvas.width) paddle.x = canvas.width - paddle.width;
    });
    window.addEventListener("touchmove", e => {
      let touch = e.touches[0];
      paddle.x = touch.clientX / window.innerWidth * canvas.width - paddle.width/2;
      if (paddle.x < 0) paddle.x = 0;
      if (paddle.x + paddle.width > canvas.width) paddle.x = canvas.width - paddle.width;
    });

    // „Éú„Çø„É≥
    document.getElementById("startBtn").addEventListener("click", startGame);
    document.getElementById("retryBtn").addEventListener("click", startGame);
  </script>
</body>
</html>
